(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{607:function(t,r,e){"use strict";e.r(r);var n=e(16),c=(e(60),e(48),e(67),e(66),e(23),{middleware:"auth",components:{changeCard:e(262).default},data:function(){return{rightDrawer:!1,right:!0,cardproducts:[],currentCat:{},currentFirstCat:{},cats:[],cats_first:[],manufacturers:[],page:1,count:0,options:{},timer:null,offset:10,loading:!1,search:"",card:{},footerProps:{"items-per-page-options":[10,25,50,100]}}},computed:{headers:function(){return[{text:"id",align:"start",sortable:!0,value:"id"},{text:"название",value:"name"},{text:"описание",value:"description"},{text:"категория",value:"cat_name"},{text:"изображение",value:"img"},{text:"производитель",value:"manufacturer_name"},{text:"действия",value:"actions"}]}},mounted:function(){this.getCardProducts(),this.getCatAll()},watch:{search:function(t){""==t?(null!=this.timer&&clearTimeout(this.timer),this.getCardProducts()):(null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.searchLoadData,700,t))},options:{handler:function(){this.getCardProducts()},deep:!0}},methods:{deleteCard:function(t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("Вы уверены?")){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,r.$axios.delete("/admin/catalog/cardproduct_admin/".concat(t.id,"/"));case 4:(n=r.cardproducts.indexOf(t))>-1&&r.cardproducts.splice(n,1),r.count=r.count-1;case 7:case"end":return e.stop()}}),e)})))()},showCard:function(t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.card=t,e.next=3,r.getCat();case 3:r.rightDrawer=!r.rightDrawer;case 4:case"end":return e.stop()}}),e)})))()},getCat:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:void 0!==t.card.cat&&null!==t.card.cat?(t.currentCat=t.cats.find((function(r){return r.id==t.card.cat})),void 0!==t.currentCat&&(t.currentFirstCat=t.cats_first.find((function(r){return r.id==t.currentCat.parent})))):(t.currentCat=null,t.currentFirstCat=null);case 1:case"end":return r.stop()}}),r)})))()},searchLoadData:function(t){var r=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var n,c,o,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.loading=!0,n=r.options,n.sortBy,n.sortDesc,c=n.page,o=n.itemsPerPage,r.offset=o*(c-1),e.next=5,r.$axios.get("/admin/catalog/cardproduct_admin/?limit=".concat(o,"&offset=").concat(r.offset,"&search=").concat(t));case 5:data=e.sent,r.cardproducts=data.data.results,r.count=data.data.count,r.loading=!1;case 9:case"end":return e.stop()}}),e)})))()},getCatAll:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var data,e,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$axios.get("/admin/catalog/category_second/?limit=99999999");case 2:return data=r.sent,t.cats=data.data.results,r.next=6,t.$axios.get("/admin/catalog/category_first/?limit=99999999");case 6:return e=r.sent,t.cats_first=e.data.results,r.next=10,t.$axios.get("/admin/catalog/manufacturers/?limit=99999999");case 10:return n=r.sent,t.manufacturers=n.data.results,r.next=14,t.$axios.get("/admin/catalog/manufacturers/?limit=99999999");case 14:r.sent;case 15:case"end":return r.stop()}}),r)})))()},getCardProducts:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var e,n,c,o,d,l,i,data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.loading=!0,e=t.options,n=e.sortBy,c=e.sortDesc,o=e.page,d=e.itemsPerPage,console.log(n),console.log(c),l="",n&&n.length)for(i in n)l+="&ordering=".concat(c[i]?"":"-").concat(n[i]);return t.offset=d*(o-1),r.next=9,t.$axios.get("/admin/catalog/cardproduct_admin/?limit=".concat(d,"&offset=").concat(t.offset).concat(l));case 9:data=r.sent,t.cardproducts=data.data.results,t.count=data.data.count,t.loading=!1;case 13:case"end":return r.stop()}}),r)})))()}}}),o=e(20),d=e(26),l=e.n(d),f=e(159),m=e(581),h=e(590),v=e(128),w=e(196),x=e(575),C=e(580),_=e(51),component=Object(o.a)(c,(function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",[e("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.cardproducts,page:t.page,"server-items-length":t.count,options:t.options,loading:t.loading,"footer-props":t.footerProps},on:{"update:page":function(r){t.page=r},"update:options":function(r){t.options=r}},scopedSlots:t._u([{key:"top",fn:function(){return[e("v-row",[e("v-col",{attrs:{cols:"1"}},[e("v-btn",{staticClass:"primary",attrs:{href:t.$axios.defaults.baseURL+"/download/product/"}},[e("v-icon",[t._v("mdi-file-download")])],1)],1),t._v(" "),e("v-col",{attrs:{cols:"1"}},[e("v-btn",{staticClass:"primary",on:{click:function(r){return t.showCard({})}}},[e("v-icon",[t._v("mdi-plus")])],1)],1),t._v(" "),e("v-col",[e("v-text-field",{staticClass:"mx-4",attrs:{label:"Поиск по базе"},model:{value:t.search,callback:function(r){t.search=r},expression:"search"}})],1)],1)]},proxy:!0},{key:"item.img",fn:function(t){var r=t.item;return[e("v-img",{attrs:{width:"80",src:r.img}})]}},{key:"item.description",fn:function(r){var n=r.item;return[e("span",{domProps:{innerHTML:t._s(n.description&&n.description.length>300?n.description.substring(0,300):n.description)}})]}},{key:"item.actions",fn:function(r){var n=r.item;return[e("v-btn",{staticClass:"error",on:{click:function(r){return t.deleteCard(n)}}},[e("v-icon",{attrs:{light:""}},[t._v("\n          mdi-delete-forever\n        ")])],1),t._v(" "),e("v-btn",{staticClass:"accent",on:{click:function(r){return t.showCard(n)}}},[e("v-icon",{attrs:{light:""}},[t._v("\n          mdi-update\n        ")])],1)]}}])}),t._v(" "),e("v-navigation-drawer",{attrs:{right:t.right,temporary:"",fixed:"",width:"60%"},model:{value:t.rightDrawer,callback:function(r){t.rightDrawer=r},expression:"rightDrawer"}},[e("changeCard",{attrs:{rightDrawer:t.rightDrawer,card:t.card,manufacturers:t.manufacturers,currentCat:t.currentCat,currentFirstCat:t.currentFirstCat,cats_first:t.cats_first,cats:t.cats},on:{"update:rightDrawer":function(r){t.rightDrawer=r},"update:right-drawer":function(r){t.rightDrawer=r},"update:card":function(r){t.card=r},"update:currentFirstCat":function(r){t.currentFirstCat=r},"update:current-first-cat":function(r){t.currentFirstCat=r}}})],1)],1)}),[],!1,null,null,null);r.default=component.exports;l()(component,{VBtn:f.a,VCol:m.a,VDataTable:h.a,VIcon:v.a,VImg:w.a,VNavigationDrawer:x.a,VRow:C.a,VTextField:_.a})}}]);