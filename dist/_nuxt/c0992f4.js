(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{566:function(t,e,r){"use strict";r.r(e);var n=r(22),c=(r(62),r(45),r(105),r(81),r(25),{components:{changeCard:r(247).default},data:function(){return{rightDrawer:!1,right:!0,cardproducts:[],currentCat:{},currentFirstCat:{},cats:[],cats_first:[],manufacturers:[],page:1,count:0,options:{},timer:null,offset:10,loading:!1,search:"",card:{},footerProps:{"items-per-page-options":[10,25,50,100]}}},computed:{headers:function(){return[{text:"id",align:"start",sortable:!0,value:"id"},{text:"название",value:"name"},{text:"описание",value:"description"},{text:"категория",value:"cat_name"},{text:"изображение",value:"img"},{text:"производитель",value:"manufacturer_name"},{text:"действия",value:"actions"}]}},mounted:function(){this.getCardProducts(),this.getCatAll()},watch:{search:function(t){""==t?(null!=this.timer&&clearTimeout(this.timer),this.getCardProducts()):(null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.searchLoadData,700,t))},options:{handler:function(){this.getCardProducts()},deep:!0}},methods:{deleteCard:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(confirm("Вы уверены?")){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,e.$axios.delete("/admin/catalog/cardproduct_admin/".concat(t.id,"/"));case 4:(n=e.cardproducts.indexOf(t))>-1&&e.cardproducts.splice(n,1),e.count=e.count-1;case 7:case"end":return r.stop()}}),r)})))()},showCard:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.card=t,r.next=3,e.getCat();case 3:e.rightDrawer=!e.rightDrawer;case 4:case"end":return r.stop()}}),r)})))()},getCat:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!=t.card.cat?(t.currentCat=t.cats.find((function(e){return e.id==t.card.cat})),t.currentFirstCat=t.cats_first.find((function(e){return e.id==t.currentCat.parent}))):(t.currentCat=null,t.currentFirstCat=null);case 1:case"end":return e.stop()}}),e)})))()},searchLoadData:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n,c,o,data;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.loading=!0,n=e.options,n.sortBy,n.sortDesc,c=n.page,o=n.itemsPerPage,e.offset=o*(c-1),r.next=5,e.$axios.get("/admin/catalog/cardproduct_admin/?limit=".concat(o,"&offset=").concat(e.offset,"&search=").concat(t));case 5:data=r.sent,e.cardproducts=data.data.results,e.count=data.data.count,e.loading=!1;case 9:case"end":return r.stop()}}),r)})))()},getCatAll:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var data,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.get("/admin/catalog/category_second/?limit=99999999");case 2:return data=e.sent,t.cats=data.data.results,e.next=6,t.$axios.get("/admin/catalog/category_first/?limit=99999999");case 6:return r=e.sent,t.cats_first=r.data.results,e.next=10,t.$axios.get("/admin/catalog/manufacturers/?limit=99999999");case 10:return n=e.sent,t.manufacturers=n.data.results,e.next=14,t.$axios.get("/admin/catalog/manufacturers/?limit=99999999");case 14:e.sent;case 15:case"end":return e.stop()}}),e)})))()},getCardProducts:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,c,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,r=t.options,r.sortBy,r.sortDesc,n=r.page,c=r.itemsPerPage,t.offset=c*(n-1),e.next=5,t.$axios.get("/admin/catalog/cardproduct_admin/?limit=".concat(c,"&offset=").concat(t.offset));case 5:data=e.sent,t.cardproducts=data.data.results,t.count=data.data.count,t.loading=!1;case 9:case"end":return e.stop()}}),e)})))()}}}),o=r(26),d=r(39),l=r.n(d),f=r(147),m=r(537),h=r(564),v=r(175),w=r(186),x=r(532),C=r(538),_=r(60),component=Object(o.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.headers,items:t.cardproducts,page:t.page,"server-items-length":t.count,options:t.options,loading:t.loading,"footer-props":t.footerProps},on:{"update:page":function(e){t.page=e},"update:options":function(e){t.options=e}},scopedSlots:t._u([{key:"top",fn:function(){return[r("v-row",[r("v-col",{attrs:{cols:"1"}},[r("v-btn",{staticClass:"primary",attrs:{href:t.$axios.defaults.baseURL+"/download/product/"}},[r("v-icon",[t._v("mdi-file-download")])],1)],1),t._v(" "),r("v-col",[r("v-text-field",{staticClass:"mx-4",attrs:{label:"Поиск по базе"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1)],1)]},proxy:!0},{key:"item.img",fn:function(t){var e=t.item;return[r("v-img",{attrs:{width:"80",src:e.img}})]}},{key:"item.description",fn:function(e){var r=e.item;return[t._v("\n      "+t._s(r.description.length>300?r.description.substring(0,300):r.description)+"\n  ")]}},{key:"item.actions",fn:function(e){var n=e.item;return[r("v-btn",{staticClass:"error",on:{click:function(e){return t.deleteCard(n)}}},[r("v-icon",{attrs:{light:""}},[t._v("\n          mdi-delete-forever\n        ")])],1),t._v(" "),r("v-btn",{staticClass:"accent",on:{click:function(e){return t.showCard(n)}}},[r("v-icon",{attrs:{light:""}},[t._v("\n          mdi-update\n        ")])],1)]}}])}),t._v(" "),r("v-navigation-drawer",{attrs:{right:t.right,temporary:"",fixed:"",width:"60%"},model:{value:t.rightDrawer,callback:function(e){t.rightDrawer=e},expression:"rightDrawer"}},[r("changeCard",{attrs:{rightDrawer:t.rightDrawer,card:t.card,manufacturers:t.manufacturers,currentCat:t.currentCat,currentFirstCat:t.currentFirstCat,cats_first:t.cats_first,cats:t.cats},on:{"update:rightDrawer":function(e){t.rightDrawer=e},"update:right-drawer":function(e){t.rightDrawer=e},"update:card":function(e){t.card=e}}})],1)],1)}),[],!1,null,null,null);e.default=component.exports;l()(component,{VBtn:f.a,VCol:m.a,VDataTable:h.a,VIcon:v.a,VImg:w.a,VNavigationDrawer:x.a,VRow:C.a,VTextField:_.a})}}]);